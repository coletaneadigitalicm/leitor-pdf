# Briefing do Leitor Digital — Versão 2.5

## 1. Propósito da Atualização
Esta versão consolida o progresso da linha 2.x do Leitor Digital após as iterações 2.0 → 2.4. O objetivo é documentar o que já foi entregue, explicitar decisões tomadas durante a implementação e listar os próximos passos necessários para completar a visão de produto.

## 2. Panorama do Produto
- **Plataforma**: Angular 20 (standalone components) com `ngx-extended-pdf-viewer` 24.x como motor de renderização.
- **Missão**: Abrir rapidamente PDFs hospedados externamente ou agrupados em coleções, oferecendo uma experiência coerente com o tema “Coletânea Digital” e mecanismos para alternar entre diversos documentos com o mínimo de atrito.
- **Usuários-chave**: Curadores de materiais (partituras, manuais, apostilas) que precisam compartilhar e navegar em vários PDFs durante eventos, cultos ou estudos.

## 3. Funcionalidades Entregues até 2.5
### 3.1 Fundamentos técnicos e visuais
- Workspace atualizado para Angular 20 com ESLint flat config, Prettier, Husky e `lint-staged` (Fase 1);
- Estrutura em camadas (`core`, `shared`, `features`) e tema “Coletânea Digital” aplicados globalmente (Fase 2);
- Layout shell com toolbar fixa responsiva e tipografia EB Garamond / Open Sans.

### 3.2 Leitura de documentos
- Leitura via query `url` (único documento) e `urls` (coleções separadas por `,` ou `|`) com histórico inteligente;
- Componente `ViewerPage` independente com estados `idle`, `loading`, `ready` e feedback de erro contextual;
- Overlay de carregamento prioritário para o PDF ativo e carregamento paralelo em segundo plano dos demais documentos;
- Ingestão de arquivos locais pelo botão “Selecionar arquivo” (opção de fallback).

### 3.3 Gestão de múltiplos PDFs
- Carrossel com abas independentes, estados (ativo/inativo/loading/erro) e badges com contagem de páginas quando disponível;
- Serviço `ViewerState` com priorização do primeiro documento, cache e reconciliação entre URLs e seleção ativa;
- Tap zones dinâmicas nos cantos de cada página para avançar/voltar mesmo em modo zoom (em substituição ao swipe);
- Botões “Mostrar/Esconder atalhos” planejados para exibir setas sem interferir nos controles nativos do viewer (UI em andamento).

### 3.4 Observabilidade e UX
- Logging de eventos críticos (page change, load failures) durante o desenvolvimento;
- `MutationObserver` garantindo reinstalação das tap zones ao navegar ou aplicar zoom;
- Componentes preparados para ajustes visuais leves (mostrar setas translúcidas nos atalhos) sem tocar na lógica principal.

## 4. Decisões Tomadas
1. **Gestos → Tap Zones**: O swipe horizontal foi removido por inconsistência entre navegadores; a navegação por cantos (click/tap) ficou mais previsível e ganha reforço visual sob demanda.
2. **Botões invisíveis por padrão**: Mantêm a experiência “limpa”; quando habilitados, exibem setas com ~2% de opacidade para orientar usuários iniciantes.
3. **Observador centralizado**: O `MutationObserver` no `ngx-extended-pdf-viewer` evita regressões quando o motor interno recria páginas (zoom, lazy load, virtual scroll).
4. **Compatibilidade de fontes**: Strings no código foram normalizadas para ASCII simples, evitando erros de build em ambientes Windows.
5. **Layouts relativos a viewport/canvas**: Tamanho das zonas de toque proporcional ao `canvasWrapper`, para escalar corretamente do mobile ao desktop.

## 5. Backlog Prioritário (2.6 → 3.0)
| Item | Descrição | Observações |
|------|-----------|-------------|
| **Legendagem dos atalhos** | Concluir a UI de “mostrar/esconder atalhos” na toolbar e acessibilidade (aria live, tooltips). | Aproveitar `ViewerStateService` para persistir preferência. |
| **Refino de estados visuais** | Atualizar cores do carrossel conforme diretrizes 2.x e alinhar badges à paleta dourado/marrom. | Depende de nova identidade aprovada. |
| **Controles globais do viewer** | Reexpor ações do `ngx-extended-pdf-viewer` (zoom, modo página, busca) com wrappers próprios. | Avaliar se mantemos os nativos ou criamos painel simplificado. |
| **Tratamento de CORS** | Investigar proxy/`fetch` com retry e mensagens amigáveis. | Minimiza erros frequentes de fontes externas. |
| **Internacionalização** | Preparar strings para i18n (ex.: inglês/espanhol). | Hooks já previstos no `app.config.ts`. |
| **Busca e anotações** | Roadmap futuro: habilitar `textLayer` + busca, investigar editor de anotações do viewer. | Requer estudo de impacto em performance. |
| **Testes end-to-end** | Adicionar testes com Playwright ou Cypress cobrindo ingestão, troca de página e atalhos. | Garantir estabilidade antes de release público. |

## 6. Riscos & Ações Mitigadoras
- **Mudanças breaking no `ngx-extended-pdf-viewer`**: manter pin fixo na versão 24.x e acompanhar changelog; considerar suite básica de regressão.
- **Eventos nativos vs. UI customizada**: tap zones ficam sincronizadas via observer; documentar estrutura DOM caso seja necessário customizar o viewer.

## 7. Checklist de Qualidade Atual
- [x] Lint (`npm run lint`) e formatação (`npm run format`) automáticos;
- [x] Loader e estados de erro testados manualmente;
- [x] Multi documento (URLs + arquivos) validado;
- [ ] Testes automatizados (unit/E2E) — **pendente**;
- [ ] Documentação de deploy e monitoramento — **pendente**.

---
**Resumo**: A versão 2.5 entrega a base Angular renovada, o tema oficial, o fluxo de múltiplos PDFs com tap zones e feedback confiável. As próximas iterações devem focar em descoberta da funcionalidade (UI de atalhos), refinamento visual, testes automatizados e roadmap de recursos avançados (busca, anotações, i18n). A plataforma já está pronta para suportar essas evoluções sem retrabalho estrutural.*** End Patch
